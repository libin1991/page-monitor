/**
 * pageMonitor https://wmfe.github.io/page-monitor/
 * 百度外卖 - 前端数据捕获与上报组件
 */
~function(e){function t(e){var t=/(chrome)\/(\d+\.\d)/,n=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/,o=/(opera)(?:.*version)?[ \/]([\w.]+)/,r=/(msie) ([\w.]+)/,a=/(mozilla)(?:.*? rv:([\w.]+))?/;e=e.toLowerCase();var i=t.exec(e)||o.exec(e)||r.exec(e)||e.indexOf("compatible")<0&&a.exec(e)||[];return n.exec(e)&&!/chrome/.test(e)&&(i[1]="safari",i[2]=RegExp.$1||RegExp.$2),{browser:i[1]||"unknown",version:i[2]||"0"}}function n(){for(var e=document.body.childNodes,t="",n=e.length-1;n>=0;n--)if(e[n].nodeType==document.COMMENT_NODE){t=e[n].textContent;break}return t}function o(e){var t=!1;return Array.isArray(e)?(e.some(function(e,n){e.test(i.href)&&(t=!0)}),e.length?null:t=!0):t=e==i.href,t}function r(e,t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);
return n}var a=e.navigator,i=e.location,c=e.screen,d=e.document,u=e.BDWMMonitor||{};u.url="//log.waimai.baidu.com/static/exceptionjs.gif?",u.beforeReport=function(e,t){return t},u.init=function(e,r){u._conf={platform:r.platform,app:r.app,channel:r.channel,pageid:r.pageid||0,traceCode:""},r.url?u.url=r.url:null,r.beforeReport?u.beforeReport=r.beforeReport:null,o(r.pageWhiteList)&&e.forEach(function(e,t){u.use(e)});var i=function(){u._conf.traceCode=n()};window.addEventListener("DOMContentLoaded",function(){i(),window.removeEventListener("DOMContentLoaded",i)});var d=t(a.userAgent),s=c.width+"*"+c.height+"|"+c.availWidth+"*"+c.availHeight;"pc"===r.channel&&(u._conf.browser=d.browser+"|"+d.version),u._conf._screen=s},u._module={},u.define=function(e,t){if(u._module[e])throw new Error(e+" Already defined");
u._module[e]=t()},u.report=function(e,t){if(u.url&&e&&t){if(t=u.beforeReport(e,t),!t)throw new Error("Report data is empty");var n=u._conf;if(!n.app||!n.channel||!n.platform)throw new Error("Global report data fragmentary");t=r(n,t);var o=d.createElement("img"),a=u.url,i=[];for(var c in t)i.push(c+"="+encodeURIComponent(t[c]));var s="img_"+ +new Date;u[s]=o,o.onload=o.onerror=function(){u[s]=o=o.onload=o.onerror=null,delete u[s]},o.src=a+(a.indexOf("?")<0?"?":"&")+i.join("&")}},u.error=function(e){u.report("exception",e)},u.use=function(e){u._module[e]&&u._module[e].run()},e.BDWMMonitor=u}(window),function(e){var t=e.BDWMMonitor,n=window.location;t.define("exception",function(){return{run:function(){this.catchException()},catchException:function(){function e(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),n=e.toString();
return t.indexOf(n)<0&&(t=n+"@"+t),t}window.onerror=function(o,r,a,i,c){var d=o;c&&c.stack&&(d=e(c)),t.report("exception",{tag:"js_error",err_txt:d,url:r,purl:n.href,ln:a,col:i,err_status:401})}}}})}(window),function(e){var t=e.BDWMMonitor,n=window.location;t.define("net",function(){return{run:function(){this.resourceHook(),this.initXhrHook()},resourceHook:function(){window.addEventListener("error",function(e){var o=e.srcElement||e.target;if(o instanceof HTMLElement){var r=o.tagName.toLowerCase();/script|link|img/.test(r)&&t.report("exception",{tag:"resource_error",url:o.src||o.href,purl:n.href,err_status:"404",err_msg:"Not Found"})}},!0),this.resourceLoadAdapter(!0),this.resourceLoadAdapter(!1)},resourceLoadAdapter:function(t){var n=function(){},o=function(){},r="_resourceLoadSucc",a="_resourceLoadFail",i=t?r:a,c=t?n:o;
if(e[i]){var d=e[i];e[i]=function(e){d(e),c(e)}}else e[i]=c},initXhrHook:function(){var e=this;window.XMLHttpRequest&&e.xhrHook(window.XMLHttpRequest),document.addEventListener("DOMContentLoaded",function(t){e.initjQueryAjaxHook()})},initjQueryAjaxHook:function(){(window.jQuery||window.Zepto)&&$(document).ajaxError(function(e,o,r,a){t.report("exception",{tag:"xhr",url:r.url,method:r.type,purl:n.href,err_status:o.status,err_txt:o.statusText})})},xhrHook:function(t){var n=t.prototype.open,o=t.prototype.send,r=this,a="";t.prototype.open=function(e,t){return this._track={method:e.toLowerCase(),url:t},a="xhr_"+ +new Date,n.apply(this,arguments)},t.prototype.send=function(){return this._trackName=a,e[a]=!0,r.registerComplete(this),o.apply(this,arguments)}},registerComplete:function(e){var t=this;e.addEventListener?e.addEventListener("readystatechange",function(){
4==e.readyState&&t.checkComplete(e)},!0):setTimeout(function(){var n=e.onload;e.onload=function(){return t.checkComplete(e),n.apply(e,arguments)};var o=e.onerror;e.onerror=function(){return t.checkComplete(e),o.apply(e,arguments)}},0)},checkComplete:function(o){o._track&&(e[o._trackName]&&o.status>=400&&t.report("exception",{tag:"xhr",url:o._track.url,method:o._track.method,purl:n.href,err_status:o.status,err_txt:o.statusText}),delete o._trackName,delete o._track,delete e[o._trackName])}}})}(window),function(e){function t(e){var t=r.timing,n=t[e+"Start"]?t[e+"Start"]:0,o=t[e+"End"]?t[e+"End"]:0;return{start:n,end:o,value:0<o-n?o-n:0}}function n(e,t,n){if(e.length===+e.length)for(var o=0;o<e.length;o++)t.call(n,o,e[o],e);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,r,e[r],e)}var o=e.BDWMMonitor,r=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;
o.define("perf",function(){var e={},a={};return{run:function(){this.domHook()},domHook:function(){var e=this,t=function(){"complete"==document.readyState&&setTimeout(function(){e.collectPerf(),document.removeEventListener("readystatechange",t)},100)};"complete"!==document.readyState&&document.addEventListener("readystatechange",t)},collectPerf:function(){r&&(this.collect(),o.report("perf",a))},collect:function(){if(r){var o=r.timing,i=t("navigation"),c=t("request"),d=t("response"),u=t("domainLookup"),s=t("connect"),p=t("loadEvent"),l=(t("unloadEvent"),o.navigationStart);e.p_dns=o.domainLookupEnd,e.p_ct=o.connectEnd,e.p_st=o.responseStart,e.p_tt=o.responseEnd,e.p_dct=o.domComplete,e.p_olt=o.loadEventEnd,n(e,function(t,n){e[t]=Math.max(n-l,0)});var f={p_lookup:u.value,p_tcp:s.value,p_ssl:o.secureConnectionStart>0?o.connectEnd-o.secureConnectionStart:0,
p_ttfb:d.start-c.start,p_download:d.value,p_to_download:d.end-i.start,p_to_connect:s.end-i.start,p_dom_ready:o.domComplete-o.domLoading,p_to_dom_ready:o.domComplete-o.navigationStart,p_dom_loaded:p.value,p_to_dom_loaded:p.end-i.start,p_net:c.start-i.start,p_srv:d.end-c.start,p_brw:p.end-o.domLoading};n(e,function(e,t){a[e]=t}),n(f,function(e,t){a[e]=t});var m=["network: "+f.p_net,"server: "+f.p_srv,"browser: "+f.p_brw];window.__perf=m.join("\n")}}}})}(window);