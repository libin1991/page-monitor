!function(e){var t=e.BDWMMonitor,r=window.location,n=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;t.define("net",function(){var a=["script","link","xmlhttprequest"],i=["resource","measure"],s=500;return{run:function(){this.resourceHook(),this.initXhrHook()},resourceHook:function(){window.addEventListener("error",function(e){var n=e.srcElement||e.target;if(n instanceof HTMLElement){var o=n.tagName.toLowerCase();/script|link|img/.test(o)&&t.report("exception",{tag:"resource_error",url:n.src||n.href,purl:r.href,err_status:"404",err_msg:"Not Found"})}},!0),this.initPerfObserve(),this.resourceLoadAdapter(!0),this.resourceLoadAdapter(!1)},resourceLoadAdapter:function(t){var r=function(){},n=function(){},o="_resourceLoadSucc",a="_resourceLoadFail",i=t?o:a,s=t?r:n;
if(e[i]){var c=e[i];e[i]=function(e){c(e),s(e)}}else e[i]=s},initjQueryObserve:function(){var e=this;(window.jQuery||window.Zepto)&&$(document).ajaxComplete(function(t,r,n){var o=e.getLastEntryByUrl(n.url);o&&e.analyzePerfEntry(o)})},analyzePerfEntry:function(e){var r=e.duration;r>s&&t.report("resource",{tag:"resource_timing",p_lookup:e.domainLookupEnd-e.domainLookupStart,p_tcp:e.connectEnd-e.connectStart,p_ssl:e.secureConnectionStart>0?e.connectEnd-e.secureConnectionStart:0,p_ttfb:e.responseStart-e.requestStart,p_download:e.responseEnd-e.responseStart,p_to_download:r,p_to_connect:e.connectEnd-e.fetchStart,url:e.name})},initPerfObserve:function(){var e=this;if(window.PerformanceObserver){var t=new window.PerformanceObserver(function(t){for(var r=t.getEntriesByType("resource"),n=0;n<r.length;n++){
var o=r[n];/log\.waimai\.baidu\.com/.test(o.name)||a.indexOf(o.initiatorType)!=-1&&e.analyzePerfEntry(o)}});t.observe({entryTypes:i})}},getLastEntryByUrl:function(e){var t=null;return n.getEntries().some(function(r){if(r.name==o.resolvePath(e))return t=r,!0}),t},initXhrHook:function(){var e=this;window.XMLHttpRequest&&e.xhrHook(window.XMLHttpRequest),document.addEventListener("DOMContentLoaded",function(t){e.initjQueryAjaxHook(),e.initjQueryObserve()})},initjQueryAjaxHook:function(){(window.jQuery||window.Zepto)&&$(document).ajaxError(function(e,n,o,a){t.report("exception",{tag:"xhr",url:o.url,method:o.type,purl:r.href,err_status:n.status,err_txt:n.statusText})})},xhrHook:function(t){var r=t.prototype.open,n=t.prototype.send,o=this,a="";t.prototype.open=function(e,t){return this._track={method:e.toLowerCase(),
url:t},a="xhr_"+ +new Date,r.apply(this,arguments)},t.prototype.send=function(){return this._trackName=a,e[a]=!0,o.registerComplete(this),n.apply(this,arguments)}},registerComplete:function(e){var t=this;e.addEventListener?e.addEventListener("readystatechange",function(){4==e.readyState&&t.checkComplete(e)},!0):setTimeout(function(){var r=e.onload;e.onload=function(){return t.checkComplete(e),r.apply(e,arguments)};var n=e.onerror;e.onerror=function(){return t.checkComplete(e),n.apply(e,arguments)}},0)},checkComplete:function(n){n._track&&(e[n._trackName]&&n.status>=400&&t.report("exception",{tag:"xhr",url:n._track.url,method:n._track.method,purl:r.href,err_status:n.status,err_txt:n.statusText}),delete n._trackName,delete n._track,delete e[n._trackName])}}});var o={resolvePath:function(e){var t=/^(?:[\.]{1,2}\/?)*\/?\w+/,n=/^http(?:s)?:\/\//;
if(!t.test(e)||n.test(e))return e;var o=r.href.split("/"),a=e.split("/"),i=0;return/^\.{1,2}$/.test(a[0])?(a.some(function(e){".."==e&&i++}),o=o.slice(0,Math.max(3,o.length-i-1)),o.push(a[a.length-1])):/^\/.+/.test(e)?(o=[r.protocol+"//"+r.host],o.push(e.substr(1))):(o=o.slice(0,o.length-1),o.push(e)),o.join("/")}}}(window);