!function(t){function e(e){var n=r.Net.declareResLoadSucc,o=r.Net.declareResLoadFail,i="_resourceLoadSucc",a="_resourceLoadFail",c=e?i:a,u=e?n:o;if(t[c]){var s=t[c];t[c]=function(t){s(t),u(t)}}else t[c]=u}var n="//log.waimai.baidu.com/static/exceptionjs.gif?",o=null,r={},i={type:function(t){return Object.prototype.toString.call(t)},isArr:function(t){return"[object Array]"==i.type(t)},isReg:function(t){return"[object RegExp]"==i.type(t)},isNum:function(t){return"[object Number]"==i.type(t)}};!function(t){function e(t,e){var n=this,o=function(){n.globalData.trace_code=n.getTraceCode(),window.removeEventListener("DOMContentLoaded",o)};if(!t)throw new Error("Reportor must have reportUrl");if(!e.app||!e.channel||!e.platform)throw new Error("Global report data fragmentary");n.globalData=e,n.reportUrl=t,window.addEventListener("DOMContentLoaded",o)}e.prototype={getTraceCode:function(){for(var t=document.body.childNodes,e="",n=t.length-1;n>=0;n--)if(t[n].nodeType==document.COMMENT_NODE){e=t[n].textContent;break}return e},filterFalsely:function(t){var e=[];return t.forEach(function(t,n){t[1]&&e.push(t)}),e},format:function(t){var e=this,n=[];if(i.isArr(t))t.forEach(function(t,e){2==t.length&&(i.isNum(t[1])?t[1]=Math.max(0,t[1].toFixed(2)):t[1]=encodeURIComponent(t[1]),n.push(t))});else{t=Object(t);for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];n.push([o,r])}n=e.format(n)}return n},report:function(t,e){var n=this;t=n.format(Object.assign({},n.globalData,t)),e&&(t=n.filterFalsely(t)),n.send(t.reduce(function(t,e){return t+=e.join("=")+"&"},""))},send:function(t){var e=this,n=new Image,o=e.reportUrl;n.onload=function(){n=null},n.src=o+t}},t.Reportor=e}(r),function(t){var e=function(t){t=Object.assign({},t),o.report(t,!0)},n={init:function(){var t=this,e=function(){"complete"==document.readyState&&(t.initjQueryAjaxHook(),document.removeEventListener("readystatechange",e))};"complete"==document.readyState?t.initjQueryAjaxHook():document.addEventListener("readystatechange",e)},initjQueryAjaxHook:function(){jQuery&&$(document).ajaxError(function(t,n,o,r){e({url:o.url,purl:location.href,err_status:n.status,err_txt:n.statusText})})},declareResLoadFail:function(t){t instanceof HTMLElement&&e({url:t.src||t.href,purl:location.href,err_status:"404",err_msg:"Not Found"})},declareResLoadSucc:function(t){}};t.Net=n}(r),function(t){var e=window.performance.timing,n=["script","link","xmlhttprequest"],r=["resource","measure"],a=500,c={resolvePath:function(t){var e=/^(?:[\.]{1,2}\/?)*\/?\w+/,n=/^http(?:s)?:\/\//;if(!e.test(t)||n.test(t))return t;var o=location.href.split("/"),r=t.split("/"),i=0;return/^\.{1,2}$/.test(r[0])?(r.some(function(t){".."==t&&i++}),o=o.slice(0,Math.max(3,o.length-i-1)),o.push(r[r.length-1])):/^\/.+/.test(t)?(o=[location.protocol+"//"+location.host],o.push(t.substr(1))):(o=o.slice(0,o.length-1),o.push(t)),o.join("/")}},u=function(t){t=Object.assign({},t),o.report(t,!1)},s={init:function(){var t=this,e=function(){"complete"==document.readyState&&(t.initObserve(),document.removeEventListener("readystatechange",e))};"complete"==document.readyState?t.initObserve():document.addEventListener("readystatechange",e)},initAjaxObserve:function(){(window.jQuery||window.Zepto)&&this.initjQueryObserve()},initjQueryObserve:function(){var t=this;$(document).ajaxComplete(function(e,n,o){var r=t.getLastEntryByUrl(o.url);r&&t.analyzePerfEntry(r)})},initPerfObserve:function(){var t=this;if(window.PerformanceObserver){var e=new window.PerformanceObserver(function(e){for(var o=e.getEntriesByType("resource"),r=0;r<o.length;r++){var i=o[r];/log\.waimai\.baidu\.com/.test(i.name)||n.indexOf(i.initiatorType)!=-1&&t.analyzePerfEntry(i)}});e.observe({entryTypes:r})}},initObserve:function(){this.initAjaxObserve()},getLastEntryByUrl:function(t){var e=null;return performance.getEntries().some(function(n){if(n.name==c.resolvePath(t))return e=n,!0}),e},analyzePerfEntry:function(t){var e=t.duration;e>a&&u({p_lookup:t.domainLookupEnd-t.domainLookupStart,p_tcp:t.connectEnd-t.connectStart,p_ssl:t.secureConnectionStart>0?t.connectEnd-t.secureConnectionStart:0,p_ttfb:t.responseStart-t.requestStart,p_download:t.responseEnd-t.responseStart,p_to_download:e,p_to_connect:t.connectEnd-t.fetchStart,url:t.name})}},d={validate:function(t){var e=!1;return i.isArr(t)?t.some(function(t,n){if(i.isReg(t)&&t.test(location.href))return e=!0,!0}):e=t==location.href,e},reportDocTiming:function(){u({p_nav:e.fetchStart-e.navigationStart,p_unload:e.unloadEventEnd-e.unloadEventStart,p_lookup:e.domainLookupEnd-e.domainLookupStart,p_tcp:e.connectEnd-e.connectStart,p_ssl:e.secureConnectionStart>0?e.connectEnd-e.secureConnectionStart:0,p_ttfb:e.responseStart-e.requestStart,p_download:e.responseEnd-e.responseStart,p_to_download:e.responseEnd-e.navigationStart,p_to_connect:e.connectEnd-e.navigationStart,ext_req_part:1})},reportDocResourceTiming:function(){u({p_dom_ready:e.domComplete-e.domLoading,p_to_dom_ready:e.domComplete-e.navigationStart,p_dom_loaded:e.loadEventEnd-e.loadEventStart,p_to_dom_loaded:e.loadEventEnd-e.navigationStart,ext_req_part:2})},init:function(t){var e=this,n=function(){"complete"==document.readyState&&setTimeout(function(){e.reportDocResourceTiming(),document.removeEventListener("readystatechange",n)},100)};this.validate(t)&&(e.reportDocTiming(),"complete"==document.readyState?e.reportDocResourceTiming():document.addEventListener("readystatechange",n))}};t.Perf={init:function(t){d.init(t),s.init()}}}(r),function(t){var e=function(t){t=Object.assign({},t),o.report(t,!0)},n={init:function(){window.addEventListener("error",function(t){console.log("error:",arguments),e({purl:location.href,url:t.filename,err_status:401,err_txt:t.message})})}};t.Runtime=n}(r),t.BDWMMonitor={init:function(t,a,c){i.isArr(t)&&t.length&&["443","80",""].indexOf(location.port)!=-1&&(o=new r.Reportor(n,{platform:a.platform,app:a.app,channel:a.channel,wid:a.wid,city_id:a.city_id,protocol:location.protocol.substr(0,location.protocol.length-1)}),t.indexOf("net")>-1&&(r.Net.init(),e(!0),e(!1)),t.indexOf("perf")>-1&&r.Perf.init(c),t.indexOf("runtime")>-1&&r.Runtime.init())}}}(window);